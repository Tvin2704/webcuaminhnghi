<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - H·ªá Th·ªëng Qu·∫£n Tr·ªã</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #ff4757;
        --primary-light: #ff6b81;
        --primary-dark: #d63031;
        --danger: #ff4757;
        --success: #00b894;
        --bg: #fff5f5;
        --card-bg: #ffffff;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: "Nunito", sans-serif;
        background: linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%);
        background-image: url('/images/nghiskibidi.png');
        background-blend-mode: overlay;
        background-size: 400px;
        background-attachment: fixed;
        margin: 0;
        padding: 20px;
        background: rgba(255, 255, 255, 0.7);
        min-height: 100vh;
        
      }

      .container {
        max-width: 700px;
        margin: 0 auto;
        position: relative;
        z-index: 1;
      }

      /* --- CARD ƒêƒÇNG B√ÄI --- */
      .card {
        background: var(--card-bg);
        padding: 25px;
        border-radius: 24px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        margin-bottom: 30px;
        border: 2px solid white;
      }

      .card-header {
        text-align: center;
        margin-bottom: 25px;
      }
      .card-header h2 {
        margin: 0;
        color: var(--primary);
        font-size: 1.5rem;
        font-weight: 800;
      }
      .card-header p {
        margin: 5px 0 0;
        font-size: 0.85rem;
        color: #777;
      }

      .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }
      .full-width {
        grid-column: 1 / -1;
      }

      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 700;
        font-size: 0.85rem;
        color: #555;
        padding-left: 5px;
      }

      input,
      select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #edf2f7;
        border-radius: 12px;
        box-sizing: border-box;
        font-size: 0.95rem;
        font-family: inherit;
        transition: 0.3s;
        background: #f8fafc;
      }

      input:focus,
      select:focus {
        border-color: var(--primary);
        outline: none;
        background: white;
      }

      .btn-post {
        width: 100%;
        padding: 16px;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        border: none;
        border-radius: 18px;
        font-weight: 800;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        margin-top: 10px;
        box-shadow: 0 8px 25px rgba(255, 71, 87, 0.4);
      }
      .btn-post:hover {
        transform: translateY(-4px) scale(1.02);
        box-shadow: 0 12px 35px rgba(255, 71, 87, 0.5);
      }
      .btn-post:active {
        transform: translateY(-2px) scale(1.01);
      }
      .btn-post:active {
        transform: scale(0.98);
      }

      /* --- DANH S√ÅCH QU·∫¢N L√ù --- */
      .list-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 15px;
        padding: 0 10px;
      }
      .list-header h3 {
        margin: 0;
        font-weight: 800;
        color: #2d3436;
      }

      .doc-item {
        display: grid;
        grid-template-columns: 1fr auto;
        align-items: center;
        background: white;
        padding: 15px 20px;
        border-radius: 18px;
        margin-bottom: 12px;
        border: 1px solid rgba(0, 0, 0, 0.03);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.02);
        transition: 0.2s;
      }
      .doc-item:hover {
        transform: scale(1.01);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.05);
      }

      .doc-info h4 {
        margin: 0 0 5px;
        font-size: 1rem;
        color: #2d3436;
      }

      /* Badge m√¥n h·ªçc & Lo·∫°i */
      .badge {
        display: inline-block;
        padding: 3px 10px;
        border-radius: 8px;
        font-size: 0.7rem;
        font-weight: 800;
        text-transform: uppercase;
        margin-right: 5px;
      }
      .badge-cat {
        background: #e0e7ff;
        color: #4338ca;
      }
      .badge-sub {
        background: #fef3c7;
        color: #92400e;
      }

      .btn-del {
        background: rgba(255, 71, 87, 0.1);
        color: var(--danger);
        border: 2px solid rgba(255, 71, 87, 0.2);
        padding: 10px 14px;
        border-radius: 14px;
        font-weight: 800;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      .btn-del:hover {
        background: linear-gradient(135deg, var(--danger), var(--primary-dark));
        color: white;
        transform: scale(1.1) rotate(5deg);
        box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
        border-color: transparent;
      }

      .btn-home {
        display: block;
        text-align: center;
        margin-top: 20px;
        text-decoration: none;
        color: #777;
        font-weight: 600;
        font-size: 0.9rem;
      }

      /* --- MOBILE OPTIMIZATION --- */
      @media (max-width: 480px) {
        body {
          padding: 15px 10px;
        }
        .form-grid {
          grid-template-columns: 1fr;
        }
        .doc-item {
          padding: 15px;
        }
        .doc-info h4 {
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <div class="card-header">
          <h2>üöÄ TH√äM TH√ìC</h2>
          <p>Th√™m th√≥c cho g√†üê£</p>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Chi·∫øn d·ªãch</label>
            <select id="category" onchange="toggleSubject()">
              <option value="v√†o10">TH C∆° S·ªü</option>
              <option value="thpt">TH Ph·ªï Th√¥ng</option>
              <option value="toeic">TOEIC</option>
              <option value="ielts">IELTS</option>
            </select>
          </div>

          <div class="form-group" id="subject-group">
            <label>M√¥n h·ªçc</label>
            <select id="subject">
              <option value="To√°n">To√°n H·ªçc</option>
              <option value="Ng·ªØ VƒÉn">Ng·ªØ VƒÉn</option>
              <option value="Ti·∫øng Anh">Ti·∫øng Anh</option>
              <option value="S·ª≠ ƒê·ªãa">S·ª≠ ƒê·ªãa</option>
              <option value="V·∫≠t L√≠">V·∫≠t L√≠</option>
              <option value="Sinh H·ªçc">Sinh H·ªçc</option>
              <option value="H√≥a H·ªçc">H√≥a H·ªçc</option>
            </select>
          </div>

          <div class="form-group full-width">
            <label>Ti√™u ƒë·ªÅ t√†i li·ªáu</label>
            <input
              type="text"
              id="title"
              placeholder="V√≠ d·ª•: ƒê·ªÅ c∆∞∆°ng √¥n thi gi·ªØa k√¨ 2..."
            />
          </div>

          <div class="form-group full-width">
            <label>Link li√™n k·∫øt (Drive/Zalo/Web)</label>
            <input
              type="text"
              id="link"
              placeholder="https://drive.google.com/..."
            />
          </div>
        </div>

        <button class="btn-post" onclick="uploadDoc()">
          C·∫¨P NH·∫¨T WEBSITE ‚ö°
        </button>
      </div>

      <div class="list-header">
        <h3>üìÇ KHO D·ªÆ LI·ªÜU</h3>
        <span
          id="doc-count"
          style="
            font-size: 0.8rem;
            background: #ddd;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
          "
          >0 file</span
        >
      </div>

      <div id="list-container">
        <p style="text-align: center; color: #999; padding: 20px">
          ƒêang t·∫£i danh s√°ch...
        </p>
      </div>

      <a href="/" class="btn-home">‚Üê Quay l·∫°i trang ch·ªß</a>
    </div>

    <script>
      // B·∫£o m·∫≠t l·ªõp 2: Ki·ªÉm tra quy·ªÅn Admin
      const role = localStorage.getItem("role");
      const user = localStorage.getItem("user");

      if (!user || (role !== "admin" && role !== "editor")) {
        alert("‚ö†Ô∏è C·∫£nh b√°o: B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p khu v·ª±c n√†y!");
        window.location.href = "/login.html";
      }

      function toggleSubject() {
        const cat = document.getElementById("category").value;
        // ·∫®n m√¥n h·ªçc n·∫øu l√† TOEIC/IELTS
        document.getElementById("subject-group").style.display =
          cat === "toeic" || cat === "ielts" ? "none" : "block";
      }

      async function uploadDoc() {
        const btn = document.querySelector(".btn-post");
        const data = {
          category: document.getElementById("category").value,
          subject:
            document.getElementById("category").value === "toeic" ||
            document.getElementById("category").value === "ielts"
              ? "Chung"
              : document.getElementById("subject").value,
          title: document.getElementById("title").value.trim(),
          link: document.getElementById("link").value.trim(),
        };

        if (!data.title || !data.link)
          return alert("S·∫øp qu√™n nh·∫≠p ti√™u ƒë·ªÅ ho·∫∑c link k√¨a!");

        btn.innerText = "ƒêANG ƒê·∫®Y L√äN...";
        btn.disabled = true;

        try {
          const res = await fetch("/api/upload", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });
          if (res.ok) {
            alert("‚úÖ ƒê√£ c·∫≠p nh·∫≠t th√†nh c√¥ng!");
            document.getElementById("title").value = "";
            document.getElementById("link").value = "";
            loadData();
          } else {
            alert("‚ùå L·ªói r·ªìi n√†y!");
          }
        } catch (err) {
          alert("‚ùå M·∫•t k·∫øt n·ªëi server!");
        } finally {
          btn.innerText = "C·∫¨P NH·∫¨T WEBSITE ‚ö°";
          btn.disabled = false;
        }
      }

      async function loadData() {
        try {
          const res = await fetch("/api/documents");
          const docs = await res.json();
          const container = document.getElementById("list-container");
          document.getElementById(
            "doc-count"
          ).innerText = `${docs.length} file`;

          if (docs.length === 0) {
            container.innerHTML =
              '<div style="text-align:center; padding:30px; color:#999;">Ch∆∞a c√≥ t√†i li·ªáu n√†o ƒë∆∞·ª£c ƒëƒÉng.</div>';
            return;
          }

          container.innerHTML = docs
            .map(
              (d) => `
                    <div class="doc-item">
                        <div class="doc-info">
                            <h4>${d.title}</h4>
                            <div>
                                <span class="badge badge-cat">${d.category}</span>
                                <span class="badge badge-sub">${d.subject}</span>
                            </div>
                        </div>
                        <button class="btn-del" onclick="deleteDoc(${d.id})" title="X√≥a t√†i li·ªáu n√†y">
                            üóëÔ∏è
                        </button>
                    </div>
                `
            )
            .reverse()
            .join("");
        } catch (e) {
          document.getElementById("list-container").innerHTML =
            "L·ªói t·∫£i d·ªØ li·ªáu.";
        }
      }

      async function deleteDoc(id) {
        if (confirm("x√≥a l√† kh√¥ng kh√¥i ph·ª•c ƒë∆∞·ª£c ƒë√¢u nha")) {
          const res = await fetch(`/api/documents/${id}`, { method: "DELETE" });
          if (res.ok) loadData();
        }
      }

      // Kh·ªüi t·∫°o
      toggleSubject();
      loadData();
    </script>
  </body>
</html>
